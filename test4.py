con.execute("""
CREATE OR REPLACE TABLE FINAL AS
SELECT
    CUSTID,
    CUSTNO,
    SORTKEY,
    SOURCE,
    BANKINDC,
    CUSTNAME,
    ACCTCODE,
    ACCTNOC,
    NOTE_NO,
    MULTINOTEIND,
    REFKEY1,
    REF1,
    REFKEY2,
    REF2,
    PRIMSEC,
    JOINTACC,
    RLENCD,
    RELATIONDESC,
    BRANCHNO,
    BRCABBRV,
    ACCTNAME,
    STATUS,
    MONITOR,
    ACCTCURRCODE,
    ACCTCURRBASE,
    PRODTYPE,
    OVERDUEAMT,
    TOTMIN,
    TOTCOMBLIMIT,
    DUEDAY,
    DATEOPEN,
    DATECLOSE
FROM (
    -- ===== MATCHED RECORDS =====
    SELECT
        A.CUSTID,
        COALESCE(A.CUSTNO, '') AS CUSTNO,
        '' AS SORTKEY,
        'PBB' AS SOURCE,
        '' AS BANKINDC,
        COALESCE(A.CUSTNAME, '') AS CUSTNAME,
        COALESCE(A.ACCTCODE, '') AS ACCTCODE,
        COALESCE(A.ACCTNOC, '') AS ACCTNOC,
        '' AS NOTE_NO,
        '' AS MULTINOTEIND,
        '' AS REFKEY1,
        '' AS REF1,
        '' AS REFKEY2,
        '' AS REF2,
        COALESCE(A.PRIMSEC, '') AS PRIMSEC,
        COALESCE(A.JOINTACC, '') AS JOINTACC,
        COALESCE(A.RLENCD, '') AS RLENCD,
        COALESCE(A.RELATIONDESC, '') AS RELATIONDESC,
        '001' AS BRANCHNO,
        'HOE' AS BRCABBRV,
        COALESCE(A.ACCTNAME, '') AS ACCTNAME,
        COALESCE(A.STATUS, '') AS STATUS,
        COALESCE(A.MONITOR, '') AS MONITOR,
        'MYR' AS ACCTCURRCODE,
        'MYR' AS ACCTCURRBASE,
        COALESCE(A.ACCTCODE, '') AS PRODTYPE,
        COALESCE(A.OVERDUEAMT, 0) AS OVERDUEAMT,
        COALESCE(A.TOTMIN, 0) AS TOTMIN,
        COALESCE(A.TOTCOMBLIMIT, 0) AS TOTCOMBLIMIT,
        COALESCE(A.DUEDAY, '') AS DUEDAY,
        COALESCE(A.DATEOPEN, '0001-01-01') AS DATEOPEN,
        COALESCE(A.DATECLOSE, '0001-01-01') AS DATECLOSE
    FROM MATCHED_REC A

    UNION ALL

    -- ===== UNMATCHED RECORDS =====
    SELECT
        A.CUSTID,
        A.ACCTNOC AS CUSTNO,
        '' AS SORTKEY,
        'PBB' AS SOURCE,
        '' AS BANKINDC,
        COALESCE(A.ACCTNAME, '') AS CUSTNAME,
        COALESCE(A.ACCTCODE, '') AS ACCTCODE,
        COALESCE(A.ACCTNOC, '') AS ACCTNOC,
        '' AS NOTE_NO,
        '' AS MULTINOTEIND,
        '' AS REFKEY1,
        '' AS REF1,
        '' AS REFKEY2,
        '' AS REF2,
        '' AS PRIMSEC,
        '' AS JOINTACC,
        '' AS RLENCD,
        '' AS RELATIONDESC,
        '001' AS BRANCHNO,
        'HOE' AS BRCABBRV,
        COALESCE(A.ACCTNAME, '') AS ACCTNAME,
        COALESCE(A.STATUS, '') AS STATUS,
        COALESCE(A.MONITOR, '') AS MONITOR,
        'MYR' AS ACCTCURRCODE,
        'MYR' AS ACCTCURRBASE,
        COALESCE(A.ACCTCODE, '') AS PRODTYPE,
        COALESCE(A.OVERDUEAMT, 0) AS OVERDUEAMT,
        COALESCE(A.TOTMIN, 0) AS TOTMIN,
        COALESCE(A.TOTCOMBLIMIT, 0) AS TOTCOMBLIMIT,
        COALESCE(A.DUEDAY, '') AS DUEDAY,
        COALESCE(A.DATEOPEN, '0001-01-01') AS DATEOPEN,
        COALESCE(A.DATECLOSE, '0001-01-01') AS DATECLOSE
    FROM UN_MATCHED_REC A
)
""")
