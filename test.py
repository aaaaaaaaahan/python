convert program to python with duckdb and pyarrow
duckdb for process input file and output parquet&txt
assumed all the input file ady convert to parquet can directly use it

//*---------------------------------------------------------------------
//* GET DESCRIPTION
//*---------------------------------------------------------------------
//CHGDESC  EXEC SAS609
//SORTWK01 DD UNIT=SYSDA,SPACE=(CYL,(1000,500))
//SORTWK02 DD UNIT=SYSDA,SPACE=(CYL,(1000,500))
//SORTWK03 DD UNIT=SYSDA,SPACE=(CYL,(1000,500))
//RPTALL   DD DISP=SHR,DSN=RBP2.B033.CIS.IDIC.DAILY.RPT.OUT
//RECCTZ   DD DISP=SHR,DSN=RBP2.B033.CIS.BANKCTRL.CITZN
//RECRES   DD DISP=SHR,DSN=RBP2.B033.CIS.BANKCTRL.RESTR
//RECSAL   DD DISP=SHR,DSN=RBP2.B033.CIS.BANKCTRL.SALES
//CCODE    DD DISP=SHR,DSN=RBP2.B033.CIS.BANKCTRL.MISC6
//BGCFL    DD DISP=SHR,DSN=RBP2.B033.CIS.BANKCTRL.MISC8
//MSICFL   DD DISP=SHR,DSN=RBP2.B033.CIS.BANKCTRL.MISC9
//MASCOFL  DD DISP=SHR,DSN=RBP2.B033.CIS.BANKCTRL.MISC10
//EMPSEC   DD DISP=SHR,DSN=RBP2.B033.CIS.BANKCTRL.EMPSEC
//EMPTYPE  DD DISP=SHR,DSN=RBP2.B033.CIS.BANKCTRL.EMPTYPE
//OUTFILE  DD DSN=RBP2.B033.CIS.IDIC.DAILY.RPT,
//            DISP=(NEW,CATLG,DELETE),
//            SPACE=(CYL,(50,50),RLSE),UNIT=SYSDA,
//            DCB=(LRECL=500,BLKSIZE=0,RECFM=FB)
//SASLIST  DD SYSOUT=X
//SYSIN    DD *
OPTION NOCENTER;

DATA RECCTZ;
  INFILE RECCTZ;
   INPUT @10   CITIZEN                $02.
         @40   DESC                   $40.;
PROC SORT  DATA=RECCTZ; BY CITIZEN;
PROC PRINT DATA=RECCTZ(OBS=5);TITLE 'RECCTZ ';
RUN;

DATA RECPRC;
  INFILE RECCTZ;
   INPUT @10   PRCOUNTRY              $02.
         @40   DESC                   $40.;
PROC SORT  DATA=RECPRC; BY PRCOUNTRY;
PROC PRINT DATA=RECPRC(OBS=5);TITLE 'RECPRC ';
RUN;

DATA RECRES;
  INFILE RECRES;
   INPUT @10   RESIDEN                $03.
         @40   DESC                   $40.;
PROC SORT  DATA=RECRES; BY RESIDEN;
PROC PRINT DATA=RECRES(OBS=5);TITLE 'RECRES ';
RUN;

DATA RECSAL;
  INFILE RECSAL;
   INPUT @10   SALES                  $03.
         @40   DESC                   $40.;
PROC SORT  DATA=RECSAL; BY SALES;
PROC PRINT DATA=RECSAL(OBS=5);TITLE 'RECSAL ';
RUN;

DATA CCODE;
  INFILE CCODE;
   INPUT @08   CUSTCODE               $03.
         @43   DESC                   $25.;
PROC SORT  DATA=CCODE; BY CUSTCODE;
PROC PRINT DATA=CCODE(OBS=5);TITLE 'MISC6  ';
RUN;

DATA BGCFL;
  INFILE BGCFL;
   INPUT @08   BGCCODE                $03.
         @43   DESC                   $25.;
PROC SORT  DATA=BGCFL; BY BGCCODE;
PROC PRINT DATA=BGCFL(OBS=5);TITLE 'BGC    ';
RUN;

DATA MSICFL;
  INFILE MSICFL;
   INPUT @08   MSICCODE               $05.
         @43   DESC                   $25.;
PROC SORT  DATA=MSICFL;BY MSICCODE;
PROC PRINT DATA=MSICFL (OBS=5);TITLE 'MSIC   ';
RUN;

DATA MASCOFL;
  INFILE MASCOFL;
   INPUT @08   MASCOCODE              $05.
         @43   DESC                   $25.;
PROC SORT  DATA=MASCOFL;BY MASCOCODE;
PROC PRINT DATA=MASCOFL (OBS=5);TITLE 'MASCO   ';
RUN;

DATA EMPSEC;
  INFILE EMPSEC;
   INPUT @21   EMPSEC                 $05.
         @55   DESC                   $80.;
PROC SORT  DATA=EMPSEC;BY EMPSEC;
PROC PRINT DATA=EMPSEC  (OBS=5);TITLE 'EMPSEC  ';
RUN;

DATA EMPTYPE;
  INFILE EMPTYPE;
   INPUT @21   EMPTYPE                $05.
         @55   DESC                   $80.;
PROC SORT  DATA=EMPTYPE;BY EMPTYPE;
PROC PRINT DATA=EMPTYPE  (OBS=5);TITLE 'EMPTYPE ';
RUN;

DATA CK_CTZN CK_RSDN CK_SALE CK_CCODE CK_BGC CK_MSIC CK_MASCO
     CK_EMPSEC CK_EMPTYPE OUTOTH CK_PRCTRY;
  INFILE RPTALL;
   INPUT @001   UPDOPER         $10.
         @021   CUSTNO          $20.
         @041   ACCTNOC         $20.
         @061   CUSTNAME        $40.
         @101   FIELDS          $20.
         @121   OLDVALUE        $150.
         @271   NEWVALUE        $150.
         @424   UPDDATE         $10.
         ;
         IF FIELDS = 'NATIONALITY' AND OLDVALUE NOT = ' ' THEN DO;
            INDX = 'Y';
            CITIZEN = SUBSTR(OLDVALUE,1,2);
            OUTPUT CK_CTZN;
         END;
         IF FIELDS = 'RESIDENCY' AND OLDVALUE NOT = ' ' THEN DO;
            INDX = 'Y';
            RESIDEN = SUBSTR(OLDVALUE,1,3);
            OUTPUT CK_RSDN;
         END;
         IF FIELDS = 'CORPORATE STATUS' AND OLDVALUE NOT = ' ' THEN DO;
            INDX = 'Y';
            SALES = SUBSTR(OLDVALUE,1,3);
            OUTPUT CK_SALE;
         END;
         IF FIELDS = 'CUSTOMER CODE' AND OLDVALUE NOT = ' ' THEN DO;
            INDX = 'Y';
            CUSTCODE = SUBSTR(OLDVALUE,1,3);
            OUTPUT CK_CCODE;
         END;
         IF FIELDS ='ENTITY TYPE' AND OLDVALUE NOT = ' ' THEN DO;
            INDX = 'Y';
            BGCCODE = SUBSTR(OLDVALUE,1,3);
            OUTPUT CK_BGC;
         END;
         IF FIELDS ='MSIC 2008' AND OLDVALUE NOT = ' ' THEN DO;
            INDX = 'Y';
            MSICCODE = SUBSTR(OLDVALUE,1,5);
            OUTPUT CK_MSIC;
         END;
         IF FIELDS ='MASCO OCCUPATION' AND OLDVALUE NOT = ' ' THEN DO;
            INDX = 'Y';
            MASCOCODE = SUBSTR(OLDVALUE,1,5);
            OUTPUT CK_MASCO;
         END;
         IF FIELDS ='EMPLOYMENT SECTOR' AND OLDVALUE NOT = ' ' THEN DO;
            INDX = 'Y';
            EMPSEC = SUBSTR(OLDVALUE,1,5);
            OUTPUT CK_EMPSEC;
         END;
         IF FIELDS ='EMPLOYMENT TYPE' AND OLDVALUE NOT = ' ' THEN DO;
            INDX = 'Y';
            EMPTYPE = SUBSTR(OLDVALUE,1,5);
            OUTPUT CK_EMPTYPE;
         END;
         IF FIELDS ='PR COUNTRY' AND OLDVALUE NOT = ' ' THEN DO;
            INDX = 'Y';
            PRCOUNTRY = SUBSTR(OLDVALUE,1,2);
            OUTPUT CK_PRCTRY;
         END;
         IF INDX NOT = 'Y' THEN OUTPUT OUTOTH;
PROC SORT  DATA=CK_CTZN; BY CITIZEN;
PROC PRINT DATA=CK_CTZN(OBS=5);TITLE 'CK_CTZN';
PROC SORT  DATA=CK_RSDN; BY RESIDEN;
PROC PRINT DATA=CK_RSDN(OBS=5);TITLE 'CK_RSDN';
PROC SORT  DATA=CK_SALE; BY SALES;
PROC PRINT DATA=CK_SALE(OBS=5);TITLE 'CK_SALE';
PROC SORT  DATA=CK_CCODE; BY CUSTCODE;
PROC PRINT DATA=CK_CCODE(OBS=5);TITLE 'CK_CODE';
PROC SORT  DATA=CK_BGC; BY BGCCODE;
PROC PRINT DATA=CK_BGC(OBS=5);TITLE 'CK_BGC';
PROC SORT  DATA=CK_MSIC; BY MSICCODE;
PROC PRINT DATA=CK_MSIC(OBS=5);TITLE 'CK_MSIC';
PROC SORT  DATA=CK_MASCO; BY MASCOCODE;
PROC PRINT DATA=CK_MASCO(OBS=5);TITLE 'CK_MASCO';
PROC PRINT DATA=OUTOTH(OBS=5);TITLE 'OUTOTH  ';
PROC SORT  DATA=CK_EMPSEC; BY EMPSEC;
PROC SORT  DATA=CK_EMPTYPE; BY EMPTYPE;
PROC SORT  DATA=CK_PRCTRY;  BY PRCOUNTRY;
RUN;

   DATA MRGCTZ;
        MERGE CK_CTZN(IN=A) RECCTZ(IN=B);BY CITIZEN;
        IF A;
        IF DESC NOT = ' ' THEN OLDVALUE = DESC;
   RUN;
   PROC PRINT DATA=MRGCTZ(OBS=15);TITLE 'RESULT OLD CTZN';RUN;

   DATA MRGRSD;
        MERGE CK_RSDN(IN=C) RECRES(IN=D);BY RESIDEN;
        IF C;
        IF DESC NOT = ' ' THEN OLDVALUE = DESC;
   RUN;
   PROC PRINT DATA=MRGRSD(OBS=15);TITLE 'RESULT OLD RESI';RUN;

   DATA MRGSAL;
        MERGE CK_SALE(IN=E) RECSAL(IN=F);BY SALES;
        IF E;
        IF DESC NOT = ' ' THEN OLDVALUE = DESC;
   RUN;
   PROC PRINT DATA=MRGSAL(OBS=15);TITLE 'RESULT OLD SALE';RUN;

   DATA MRGCCD;
        MERGE CK_CCODE(IN=G) CCODE(IN=H);BY CUSTCODE;
        IF G;
        IF DESC NOT = ' ' THEN OLDVALUE = DESC;
   RUN;
   PROC PRINT DATA=MRGCCD(OBS=15);TITLE 'RESULT OLD MSIC6';RUN;

   DATA MRGBGC;
        MERGE CK_BGC(IN=I) BGCFL(IN=J);BY BGCCODE;
        IF I;
        IF DESC NOT = ' ' THEN OLDVALUE = DESC;
   RUN;
   PROC PRINT DATA=MRGBGC(OBS=15);TITLE 'RESULT OLD BGC';RUN;

   DATA MRGMSC;
        MERGE CK_MSIC(IN=K) MSICFL(IN=L);BY MSICCODE;
        IF K;
        IF DESC NOT = ' ' THEN OLDVALUE = DESC;
   RUN;
   PROC PRINT DATA=MRGMSC(OBS=15);TITLE 'RESULT OLD MSC';RUN;

   DATA MRGMAS;
        MERGE CK_MASCO(IN=M) MASCOFL(IN=N);BY MASCOCODE;
        IF M;
        IF DESC NOT = ' ' THEN OLDVALUE = DESC;
   RUN;
   PROC PRINT DATA=MRGMAS(OBS=15);TITLE 'RESULT OLD MSC';RUN;

   DATA MRGESEC;
        MERGE CK_EMPSEC(IN=MA) EMPSEC(IN=NA);BY EMPSEC;
        IF MA;
        IF DESC NOT = ' ' THEN OLDVALUE = DESC;
   RUN;
   PROC PRINT DATA=MRGESEC(OBS=15);TITLE 'RESULT OLD SEC';RUN;

   DATA MRGETYP;
        MERGE CK_EMPTYPE(IN=MB) EMPTYPE(IN=NB);BY EMPTYPE;
        IF MB;
        IF DESC NOT = ' ' THEN OLDVALUE = DESC;
   RUN;
   PROC PRINT DATA=MRGETYP(OBS=15);TITLE 'RESULT OLD TYP';RUN;

   DATA MRGPRC;
        MERGE CK_PRCTRY(IN=MC) RECPRC(IN=NC);BY PRCOUNTRY;
        IF MC;
        IF DESC NOT = ' ' THEN OLDVALUE = DESC;
   RUN;
   PROC PRINT DATA=MRGPRC(OBS=15);TITLE 'RESULT OLD PRC';RUN;

   DATA COMOLD;
     SET MRGCTZ MRGRSD MRGSAL MRGCCD MRGBGC MRGMSC MRGMAS
         MRGETYP MRGESEC OUTOTH MRGPRC;
     KEEP UPDOPER CUSTNO ACCTNOC CUSTNAME FIELDS OLDVALUE
          NEWVALUE UPDDATE;
   RUN;
   PROC PRINT DATA=COMOLD(OBS=50);TITLE 'COMBINE OLD';RUN;

   DATA CN_CTZN CN_RSDN CN_SALE CN_CCODE CN_BGC CN_MSIC CN_MASCO OUTNEW
        CN_EMPSEC CN_EMPTYPE CN_PRCTR;
     SET COMOLD;
     KEEP UPDOPER CUSTNO ACCTNOC CUSTNAME FIELDS OLDVALUE
          NEWVALUE UPDDATE;
     KEEP CITIZEN RESIDEN SALES CUSTCODE BGCCODE MSICCODE MASCOCODE
          EMPTYPE EMPSEC PRCOUNTRY;
         IF FIELDS = 'NATIONALITY' AND NEWVALUE NOT = ' ' THEN DO;
            INDY = 'Y';
            CITIZEN = SUBSTR(NEWVALUE,1,2);
            OUTPUT CN_CTZN;
         END;
         IF FIELDS = 'RESIDENCY' AND NEWVALUE NOT = ' ' THEN DO;
            INDY = 'Y';
            RESIDEN = SUBSTR(NEWVALUE,1,3);
            OUTPUT CN_RSDN;
         END;
         IF FIELDS = 'CORPORATE STATUS' AND NEWVALUE NOT = ' ' THEN DO;
            INDY = 'Y';
            SALES = SUBSTR(NEWVALUE,1,3);
            OUTPUT CN_SALE;
         END;
         IF FIELDS = 'CUSTOMER CODE' AND NEWVALUE NOT = ' ' THEN DO;
            INDY = 'Y';
            CUSTCODE = SUBSTR(NEWVALUE,1,3);
            OUTPUT CN_CCODE;
         END;
         IF FIELDS ='ENTITY TYPE' AND NEWVALUE NOT = ' ' THEN DO;
            INDY = 'Y';
            BGCCODE = SUBSTR(NEWVALUE,1,3);
            OUTPUT CN_BGC;
         END;
         IF FIELDS ='MSIC 2008' AND NEWVALUE NOT = ' ' THEN DO;
            INDY = 'Y';
            MSICCODE = SUBSTR(NEWVALUE,1,5);
            OUTPUT CN_MSIC;
         END;
         IF FIELDS ='MASCO OCCUPATION' AND NEWVALUE NOT = ' ' THEN DO;
            INDY = 'Y';
            MASCOCODE = SUBSTR(NEWVALUE,1,5);
            OUTPUT CN_MASCO;
         END;
         IF FIELDS ='EMPLOYMENT SECTOR' AND NEWVALUE NOT = ' ' THEN DO;
            INDY = 'Y';
            EMPSEC = SUBSTR(NEWVALUE,1,5);
            OUTPUT CN_EMPSEC;
         END;
         IF FIELDS ='EMPLOYMENT TYPE' AND NEWVALUE NOT = ' ' THEN DO;
            INDY = 'Y';
            EMPTYPE = SUBSTR(NEWVALUE,1,5);
            OUTPUT CN_EMPTYPE;
         END;
         IF FIELDS ='PR COUNTRY' AND NEWVALUE NOT = ' ' THEN DO;
            INDY = 'Y';
            PRCOUNTRY = SUBSTR(NEWVALUE,1,2);
            OUTPUT CN_PRCTR;
         END;
         IF INDY NOT = 'Y' THEN OUTPUT OUTNEW;
   RUN;
PROC SORT  DATA=CN_CTZN; BY CITIZEN;
PROC PRINT DATA=CN_CTZN(OBS=5);TITLE 'CN_CTZN';
PROC SORT  DATA=CN_RSDN; BY RESIDEN;
PROC PRINT DATA=CN_RSDN(OBS=5);TITLE 'CN_RSDN';
PROC SORT  DATA=CN_SALE; BY SALES;
PROC PRINT DATA=CN_SALE(OBS=5);TITLE 'CN_SALE';
PROC SORT  DATA=CN_CCODE; BY CUSTCODE;
PROC PRINT DATA=CN_CCODE(OBS=5);TITLE 'CN_CODE';
PROC SORT  DATA=CN_BGC; BY BGCCODE;
PROC PRINT DATA=CN_BGC(OBS=5);TITLE 'CN_BGC';
PROC SORT  DATA=CN_MSIC; BY MSICCODE;
PROC PRINT DATA=CN_MSIC(OBS=5);TITLE 'CN_MSIC';
PROC SORT  DATA=CN_MASCO; BY MASCOCODE;
PROC PRINT DATA=CN_MASCO(OBS=5);TITLE 'CN_MASCO';
PROC PRINT DATA=OUTNEW(OBS=5);TITLE 'OUTNEW  ';
PROC SORT  DATA=CN_EMPSEC; BY EMPSEC;
PROC SORT  DATA=CN_EMPTYPE; BY EMPTYPE;
PROC SORT  DATA=CN_PRCTR; BY PRCOUNTRY;
RUN;

   DATA MRXCTZ;
        MERGE CN_CTZN(IN=O) RECCTZ(IN=P);BY CITIZEN;
        IF O;
        IF DESC NOT = ' ' THEN NEWVALUE = DESC;
   RUN;
   PROC PRINT DATA=MRXCTZ(OBS=15);TITLE 'RESULT NEW CTZN';RUN;

   DATA MRXRSD;
        MERGE CN_RSDN(IN=Q) RECRES(IN=R);BY RESIDEN;
        IF Q;
        IF DESC NOT = ' ' THEN NEWVALUE = DESC;
   RUN;
   PROC PRINT DATA=MRXRSD(OBS=15);TITLE 'RESULT NEW RESI';RUN;

   DATA MRXSAL;
        MERGE CN_SALE(IN=S) RECSAL(IN=T);BY SALES;
        IF S;
        IF DESC NOT = ' ' THEN NEWVALUE = DESC;
   RUN;
   PROC PRINT DATA=MRXSAL(OBS=15);TITLE 'RESULT NEW SALE';RUN;

   DATA MRXCCD;
        MERGE CN_CCODE(IN=U) CCODE(IN=V);BY CUSTCODE;
        IF U;
        IF DESC NOT = ' ' THEN NEWVALUE = DESC;
   RUN;
   PROC PRINT DATA=MRXCCD(OBS=15);TITLE 'RESULT NEW MSIC6';RUN;

   DATA MRXBGC;
        MERGE CN_BGC(IN=W) BGCFL(IN=X);BY BGCCODE;
        IF W;
        IF DESC NOT = ' ' THEN NEWVALUE = DESC;
   RUN;
   PROC PRINT DATA=MRXBGC(OBS=15);TITLE 'RESULT NEW BGC';RUN;

   DATA MRXMSC;
        MERGE CN_MSIC(IN=Y) MSICFL(IN=Z);BY MSICCODE;
        IF Y;
        IF DESC NOT = ' ' THEN NEWVALUE = DESC;
   RUN;
   PROC PRINT DATA=MRXMSC(OBS=15);TITLE 'RESULT NEW MSC';RUN;

   DATA MRXMAS;
        MERGE CN_MASCO(IN=AB) MASCOFL(IN=CD);BY MASCOCODE;
        IF AB;
        IF DESC NOT = ' ' THEN NEWVALUE = DESC;
   RUN;
   PROC PRINT DATA=MRXMAS(OBS=15);TITLE 'RESULT NEW MSC';RUN;

   DATA MRXESEC;
        MERGE CN_EMPSEC(IN=WA) EMPSEC(IN=XA);BY EMPSEC;
        IF WA;
        IF DESC NOT = ' ' THEN NEWVALUE = DESC;
   RUN;
   PROC PRINT DATA=MRXESEC(OBS=15);TITLE 'RESULT OLD SEC';RUN;

   DATA MRXETYP;
        MERGE CN_EMPTYPE(IN=WB) EMPTYPE(IN=XB);BY EMPTYPE;
        IF WB;
        IF DESC NOT = ' ' THEN NEWVALUE = DESC;
   RUN;
   PROC PRINT DATA=MRXETYP(OBS=15);TITLE 'RESULT OLD TYP';RUN;

   DATA MRXPRC;
        MERGE CN_PRCTR(IN=WC) RECPRC(IN=XC);BY PRCOUNTRY;
        IF WC;
        IF DESC NOT = ' ' THEN NEWVALUE = DESC;
   RUN;
   PROC PRINT DATA=MRXPRC(OBS=15);TITLE 'RESULT OLD PRC';RUN;

   DATA LASTREC;
     SET MRXCTZ MRXRSD MRXSAL MRXCCD MRXBGC MRXMSC MRXMAS OUTNEW
         MRXETYP MRXESEC MRXPRC;
     IF FIELDS NOT = ' ';
     RUN;
   PROC SORT  DATA=LASTREC; BY CUSTNO FIELDS;

   DATA RECORDS;
     SET LASTREC;
     FILE OUTFILE;
     PUT  @001   UPDOPER         $10.
          @021   CUSTNO          $20.
          @041   ACCTNOC         $20.
          @061   CUSTNAME        $40.
          @101   FIELDS          $20.
          @121   OLDVALUE        $150.
          @271   NEWVALUE        $150.
          @424   UPDDATE         $10.
          ;
     RUN;
